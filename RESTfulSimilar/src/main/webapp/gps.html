<script type="text/javascript">
    function createUploader() {
        var uploader = new qq.FileUploader({
            element:document.getElementById('file-uploader-gps'),
            action:'rest/hello/findGPS',
            forceMultipart:true,
            debug:false,
            onSubmit:localSubmit,
            onComplete:localFinished
        });
    }

    function localSubmit(id, name, json) {
        $('.qq-upload-list').children().remove();
        var img = document.createElement("img");

        reader = new FileReader();
        reader.onload = (function (theImg) {

            return function (evt) {
                theImg.src = evt.target.result;
            };

        }(img));
        reader.readAsDataURL(this._handler._files[id]);
        // display the source image
        $("#duplicate_gps_source").children().remove();
//        $("#duplicate_upload_result").children().remove();
        div_t = document.createElement("div");
        div_t.className = "nailthumb-container nailthumb-image-titles-animated-onhover square";
        div_t.appendChild(img);

        $("#duplicate_gps_source").append(div_t);
        jQuery(document).ready(function () {
            jQuery('.nailthumb-container').nailthumb();
            jQuery('.nailthumb-image-titles-animated-onhover').nailthumb();
        });


    }

    function localFinished(id, name, json) {
       // uploadFinished(json.images);
        //debugger
        $(".qq-upload-list").children().remove();
        if (!jQuery.isEmptyObject(json)) {
                  //   console.log(json);
            lat=json[0];
            lon=json[1];
           // initialize();
            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(lat, lon),
                title : "{"+lat + ", " + lon+ "}",
                map: map
            });
            map.setCenter(new google.maps.LatLng(lat, lon))                  ;
            google.maps.event.trigger(map, 'resize');
            map.setZoom( map.getZoom() );
        }
    }


    jQuery(document).ready(function () {
        createUploader();
    });


    // GOOGLE MAPS V3
    var map;                    //google map
    var lat = 0;
    var lon =0;


    function initialize() {
        var mapOptions = {
            center:new google.maps.LatLng(lat, lon),
            zoom:18,
            mapTypeId:google.maps.MapTypeId.HYBRID
        };
        map = new google.maps.Map(document.getElementById("map_canvas"),
                mapOptions);
        google.maps.event.addListener(map, 'tilesloaded', function () {
            google.maps.event.trigger(map, 'resize');
            //map.setCenter(mapOptions.center);
        });
    }


</script>


<div id="file-uploader-gps">
    <noscript>
        <p>Please enable JavaScript to use file uploader.</p>
        <!-- or put a simple form for upload here -->
    </noscript>
</div>

<div id="duplicate_gps_source" style="margin:10px 0px"></div>


<div id="map_canvas" style="width:500px; height:500px"></div>
