<script>
    function createUploader(){
        var uploader = new qq.FileUploader({
            element: document.getElementById('file-uploader-demo1'),
            action: 'rest/hello/findSimilar',
            forceMultipart : true,
            debug: true,
            onSubmit: localSubmit,
            onComplete:  localFinished
//            ,
//            extraDropzones: [qq.getByClass(document, 'qq-upload-extra-drop-area')[0]]
        });
    }

    function localSubmit(id, name, json) {
        $('.qq-upload-list').children().remove()
    }

    function localFinished(id, name, json) {

        var img = document.createElement("img");
       // li.appendChild(img);
        reader = new FileReader();
        reader.onload = (function (theImg) {

            return function (evt) {
                theImg.src = evt.target.result;
//                jQuery(document).ready(function () {
//                    jQuery('.nailthumb-container').nailthumb();
//                    jQuery('.nailthumb-image-titles-animated-onhover').nailthumb();
//                });
            };

        }(img));
        reader.readAsDataURL(this._handler._files[id]);

        $("#duplicate_upload_source").children().remove();
        div_t = document.createElement("div");
        div_t.className="nailthumb-container nailthumb-image-titles-animated-onhover square" ;
        div_t.appendChild(img);

        $("#duplicate_upload_source").append(div_t);
//        append('<div class="nailthumb-container nailthumb-image-titles-animated-onhover square">');
//        $("#duplicate_upload_source").append(img);
//        $("#duplicate_upload_source").append('</div>');//

        //var imgTag = "<img src=\"data:image;base64," + image.data + "\" title=\"" + image.title + "\"/>";



        uploadFinished(json.images);
    }

    // in your app create uploader as soon as the DOM is ready
    // don't wait for the window to load
    jQuery(document).ready(function() {
       createUploader();
    });
</script>


<div id="file-uploader-demo1">
    <noscript>
        <p>Please enable JavaScript to use file uploader.</p>
        <!-- or put a simple form for upload here -->
    </noscript>
</div>

<!--<div class="qq-upload-extra-drop-area">Drop files here too</div>-->


<div id="duplicate_upload_source" style="margin:10px 0px"></div>

<div id="duplicate_upload_result" style="margin:10px 0px"></div>

<!--</body>-->
<!--</html>-->